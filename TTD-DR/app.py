from self_evolution import SelfEvolution, EvolutionConfig, OpenAIClient
from dotenv import load_dotenv

# 환경 변수 로드 (OpenAI API 키 등)
load_dotenv()


# 1) 엔진 만들기 (가성비 설정)
engine = SelfEvolution(
    llm=OpenAIClient(model="gpt-4o-mini"),
    config=EvolutionConfig(variants_k=2, episodes_T=1, population_n=2)
)

# 2) 컨텍스트 넣기 (여기선 '검색결과 요약' 단계 예시)
context = {
  "user_query": "2023년 울산에 피해를 준 태풍에 대해 알려줘",
  "retrieved_docs": [
  {"snippet": "*** 산사태예측정보에 따른 적기 예보발령과 선제적 주민대피 실시할 것, 주민대피와 복구에 가용자원 총동원하여 지원할 것, 상황 발생시 신속한 상황 보고 및 응급조치 할 것\n**** ’22년, ’23년 동해안 대형산불피해지, ’22년 산사태피해복구지, 임도시설지, 산사태취약지역 등 10,438개소\n***** 12시간 이내 부단체장‧담당자 유선, 48시간 공문 발송 전파\n○ (경찰청) 경찰청장 주재 태풍 관련 전국 지휘부 화상회의(8.8.), 경찰청 재난상황실 운영, 태풍 카눈 관련 국무총리‧중앙대책본부장 지시사항 6회 하달, 태풍 특보 고려 선제적 비상근무(17개 청 224개 서), 침수 우려 지하차도·하상도로(1,722개소) 사전 점검 실시, 주민대피 지원*(경찰관 1,654명), 인명피해 우려지역 등 4,374개소 예방순찰(경찰관 7,502명), 전국 교통통제 실시(15개 시도청 404개소, 경찰관 4,837명, 순찰자 1,630대), 112신고 대응강화(시도청 90명, 경찰관 325명 총 415명 및 지역경찰 3,442명 증원)\n* 경북 도내 23개 시군 중 울릉군 제외 22개 시군에서 대피명령 발효, 947개소 7,648명 대피 완료\n○ (소방청) 태풍 ‘카눈’ 대비 비상대응태세 확립 청장 지시사항 전파(8.8.), 청장주재 전국 소방본부 긴급대응태세 점검 회의(8.8.), 중앙긴급구조통제단 가동(8.8., 18:00~), 대통령 긴급 지시사항 시달(8.8.), 중앙재난안전대책본부장 지시사항 시달(8.8.), 대용량포방사시스템(30,000L) 전진배치(8.9., 11:00~, 장소: 중앙119구조본부 충청‧강원119특수구조대), 대용량포방사시스템(45,000L) 전진배치(8.9. 15:50 ~ 8.10. 15:00, 장소: 울산광역시 태화시장), 16개 시도(제주제외) 40명 현장상황관리관 파견(8.9.), 중앙긴급구조통제단장 긴급 지시사항 각 시도 시달(8.9. 17:54), 중앙재난안전대책본부장 지시사항 시달(8.9. 23:16), 대구 군위 침수 관련 소방청장 지시사항 시달(8.10. 15:03), 대구 군위 하천 범람사고 동원령 발령(8.10. 15:30~18:00,, 동원자원 : 경북본부 및 중앙119구조본부영남대 구조대원 및 장비 등)\n※  실적 총 3,058건(안전조치 2,832건, 급·배수지원 202소/660톤, 인명구조 20건/33명, 인명피해 4부상)[1]"},
  {"snippet": "<연도별 9월에 발생한 태풍 현황 >\n\n[출처 : 기상청]\n\n< 시기별 태풍 발생 현황 >\n\n구 분 1월 2월 3월 4월 5월 6월 7월 8월 9월 10월 11월 12월 합계\n\n2022년 2 1 3(3) 5(1) 7(1) 5 1 1 25(5)\n\n2021년 - 1 - 1 1 2 3 4(2) 4(1) 4 1 1 22(3)\n\n30년평균\n(′91-′20)\n\n0.3 0.1 0.3 0.6 1.0\n1.7\n(0.3)\n\n3.7\n(1.0)\n\n5.6\n(1.2)\n\n5.1\n(0.8)\n\n3.5\n(0.1)\n\n2.3 1.2\n25.1\n(3.4)\n\n※ ( )안의 숫자는 우리나라에 영향을 준 태풍의 수를 나타냄                            [출처: 기상청] \n\n\n\n37 /61\n\n○최근 10년(’12~’21)간 9월 태풍으로 인한 피해는 총 6건이며\n\n628,508백만 원의 재산피해와 8명의 인명피해가 발생하였다.\n\n【최근 10년(’12~‘21년)간 월별 태풍 피해 현황】\n\n구 분 합계 1월 2월 3월 4월 5월 6월 7월 8월 9월 10월 11월 12월\n\n피해발생(회) 23 - - - - - 1 3 9 6 4 - --\n\n인명피해(명) 40 - - - - - - 1 11 8 20 - -\n\n재산피해\n(백만원)\n\n1,765,587 - - - - - 6,416 5,161 686,694 628,508 438,808 - -\n\n[출처: 재해연보]\n\n<태풍특보 발표 기준 >\n\n주 의 보 경    보\n\n태풍으로 인하여 강풍, 풍랑, \n\n호우, 폭풍해일 현상 등이 주의보 \n\n기준에 도달할 것으로 예상될 때\n\n태풍으로 인하여 다음 중 어느 하나에 해당하는 경우\n\n① 강풍(또는 풍랑) 경보 기준에 도달할 것으로 예상될 때\n\n② 총 강우량이 200mm 이상 예상될 때\n\n③ 폭풍해일 경보* 기준에 도달할 것으로 예상될 때\n\n * 폭풍해일 경보 : 천문조, 폭풍, 저기압 등의 복합적인 영향으로 해수면이 상승하여 발효 기준값 이상이 \n\n예상될 때. 다만, 발효 기준값은 지역별로 별도 지정\n\n번호 기 간 인명피해\n(명)\n\n재산피해\n(백만원)\n\n주요 피해지역\n\n총 5건 8 628,508\n\n1 ‘12.09.15~09.17. 2 365,716\n 부산, 대구, 광주, 대전, 울산, 세종, 경기, \n강원, 충북, 충남, 전북, 전남, 경북, 경남, \n제주\n\n2 ‘17.09.16.~09.18. - - 제주\n\n3 ‘19.09.06.~09.07. 3 33,396\n서울, 광주, 대전, 울산, 경기, 강원, 전남, \n경북 [2]"},
  {"snippet": "○최근 10년(’12~’21)간 9월 태풍으로 인한 피해는 총 6건이며\n\n628,508백만 원의 재산피해와 8명의 인명피해가 발생하였다.\n\n【최근 10년(’12~‘21년)간 월별 태풍 피해 현황】\n\n구 분 합계 1월 2월 3월 4월 5월 6월 7월 8월 9월 10월 11월 12월\n\n피해발생(회) 23 - - - - - 1 3 9 6 4 - --\n\n인명피해(명) 40 - - - - - - 1 11 8 20 - -\n\n재산피해\n(백만원)\n\n1,765,587 - - - - - 6,416 5,161 686,694 628,508 438,808 - -\n\n[출처: 재해연보]\n\n<태풍특보 발표 기준 >\n\n주 의 보 경    보\n\n태풍으로 인하여 강풍, 풍랑, \n\n호우, 폭풍해일 현상 등이 주의보 \n\n기준에 도달할 것으로 예상될 때\n\n태풍으로 인하여 다음 중 어느 하나에 해당하는 경우\n\n① 강풍(또는 풍랑) 경보 기준에 도달할 것으로 예상될 때\n\n② 총 강우량이 200mm 이상 예상될 때\n\n③ 폭풍해일 경보* 기준에 도달할 것으로 예상될 때\n\n * 폭풍해일 경보 : 천문조, 폭풍, 저기압 등의 복합적인 영향으로 해수면이 상승하여 발효 기준값 이상이 \n예상될 때. 다만, 발효 기준값은 지역별로 별도 지정\n\n번호 기 간 인명피해\n(사망)\n\n재산피해\n(억 원)\n\n주요 피해지역\n\n총 4건 20 438,808\n\n1 ‘13.10.07. ~ 10.10.  1,690 부산, 경북, 경남, 제주\n\n2 ‘16.10.03. ~ 10.06. 6 214,464 \n부산, 인천, 광주, 울산, 전북, 전남, 경북, \n경남, 제주\n\n3 ‘18.10.04. ~ 10.07. - 54,949 \n부산, 대구, 광주, 대전, 울산, 세종, 강원, \n충북, 충남, 전북, 전남, 경북, 경남, 제주\n\n4 ‘19.10.01. ~ 10.04. 14 167,705 \n부산, 대구, 광주, 울산, 경기, 강원, 충북, \n충남, 전북, 전남, 경북, 경남 제주\n\n【최근 10년(’12~‘21년)간 10월 태풍 피해 상세 현황】\n\n[출처: 재해연보]\n\n\n\n42 / 57\n\n▶ ('20.9.1.~9.7. 제9호 태풍 ’마이삭‘ 및 제10호 태풍 ’하이선‘ 피해) 출처 : 재해연보\n\n  제9호 태풍 「마이삭」\n\n ○ 8. 28일 03시경 필리핀 마닐라 동쪽 약 1,180㎞ 부근 해상에서 열대저압부 \n\n생성, 8. 28일 15시경 동북쪽 약 1,040㎞ 부근 해상에서 태풍으로 발달 [3]"}
]
}

# 3) 실행 (스테이지와 컨텍스트만 주면 끝)
result = engine.run_for_stage(stage="answer", context=context)

print(result["best_text"])  # 최종 품질 좋은 결과